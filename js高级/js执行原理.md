# js 执行原理

## 全局对象

    在全局代码执行之前会初始化一个 全局对象(GO), 里面包含 Date、Number、String 等对象，还有一个 window 对象 指向自己，并且所有的 作用域 都可以访问到这个全局对象。这个全局对象在 浏览器 中表示的就是 window

## 执行上下文栈/调用栈(ECS)

    js引擎会有一个执行上下文栈，用于调用执行的代码

## 执行上下文(EC)

    在每段代码块执行前会创建一个执行上下文，这个执行上下文会进入到执行上下文栈中

## Variable Object(VO)

    每个执行上下文都会关联一个 VO对象，这个 VO对象 在创建的时候会将 声明的 变量 和 函数 会被添加到这个对象当中， 如果是函数执行的话，也会把函数的参数添加到这个对象当中。这个过程也叫做 变量提升

## 全局代码执行过程

    执行全局代码前，会创建一个 全局执行上下文(GEC), 这个上下文会进入到执行上下文栈中，这个执行上下文会关联一个 VO 对象，而 全局执行上下文 关联的 VO 其实就是 GO 了，这个执行上下文中会有三个重要的东西。
      1. scope china
      2. VO => GO
      3. this => GO
    这也是为什么我们在代码执行的时候访问 this 找不到的时候向上层查找最后找到的是 window 的原因。
    做完这些操作后代码才开始执行，将声明的变量一个个赋值，遇到函数就会执行函数。

## 函数执行过程

    在函数代码执行前，会创建一个 函数执行上下文(FEC)， 这个上下文也会进入到执行上下文栈中，因为每个执行上下文都要关联一个 VO 对象，这时候就会在内存当中创建一个 VO对象，函数的 VO对象 就是 AO 了，这个 AO 在创建的时候会将 arguments 作为初始化，并且初始化值是传入的参数，这个 AO 对象就用于存放初始化值。
    做完这些后就开始执行函数中的代码，将一个个变量赋值，遇到函数就会执行函数，在执行函数前又会进行之前的操作，知道这个函数执行完成，这个执行上下文就会弹出栈。

## 作用域和作用域链

    作用域链是一个对象列表，用于变量的查找。变量的查找是先从 自己的 VO(作用域) 当中查找，没有找到再从自己的 作用域链 中一层一层的去查找。

    每段执行上下文也都会关联一个作用域链，而在进入一个执行上下文时，这个作用域链就会被创建，作用域的一系列对象，是根据代码类型来决定的。(ES5/ES6)

    在 ES5 时，代码只有两种类型，全局代码 和 函数代码，而全局执行上下文的作用域链其实就是 GO 了，而函数代码的作用域链是在函数定义时就已经决定了，在进入一个函数执行上下文的时候函数的作用域链就会关联到函数执行上下文中作为作用域链，用于变量的查找。

### 闭包

    如果一个函数可以访问到外层的变量，那么这个函数和周围的环境(外层作用域)就叫做闭包

    广义角度: 在 js 中，一个函数就是一个闭包
    狭义角度: 在 js 中，如果一个函数访问了外层变量，那就是闭包