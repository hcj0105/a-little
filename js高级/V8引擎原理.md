# V8 引擎原理

## 浏览器拿到 js 代码后解析到执行过程？

    1. 将 js 代码 解析 成 抽象语法树(ast 树)
    2. 将 抽象语法树 转化成 字节码
    3. 将 字节码 编译成 机器码
    4. cpu 将 机器码 运行起来

## v8 引擎核心模块

    1. Parse(解析)
      因为 解释器 不认识 js 代码 需要 这一步 将 js 代码 解析成 ast 树
    2. lgnition(解释器)
      将 ast 树 解释成 字节码，同时在这个过程中收集 编译器 优化需要的信息
    3. TuboFan(编译器)
      将 字节码 编译成 cpu 可以执行的 机器码，在这个过程中，如果有多次同样的函数执行，编译器会将它编辑成热点函数，编译成优质机器码，如果下次执行的热点函数不一样了，会讲热点函数重新编译成 字节码。

## 垃圾回收

    1. 内存管理
      在每次创建一个对象的时候在堆内存中就会创建一块内存区域，如果没有进行内存管理的话，就会导致内存爆满。

      内存管理一般都会有这些声明周期：
        - 分配内存
        - 使用内存
        - 释放内存

    2. 垃圾回收
      因为内存的大小是有限的，所以我们需要对其进行释放内存，这样就可以腾出更多的空间

    3. 垃圾回收相关算法
      - 引用计数
        每当一个引用指向这个内存地址的时候，内存地址就会记录1次引用，当引用的次数为0的时候，这块内存就会被释放。

        缺点: 会造成循环引用，没办法释放内存，这时候需要手动去释放。 比如： 相互引用的对象

      - 标记清除(可达性)
        会创建一个 根对象, 从这个根对象一直找到有引用的对象，对于那些没有引用的对象就说明是不可用的，内存就会被释放。就可以很好的解决循环引用的问题。

    4. V8引擎对垃圾回收算法进行优化的其他算法
      - 标记整理
        将不连续的内存整理成连续的内存，这样在分配内存的时候会有更多的空间。

      - 分代收集
        内存会被分成 新的 和 旧的，对于使用次数少的对象会被释放，对于频繁使用的对象会被放入到旧的内存空间当中。

      - 增量收集
        在垃圾回收机制运行的时候js代码是无法运行的，如果出现很多对象的话要循环去标记，这样就会出现明显的延迟，所以引擎就会将垃圾收集分成几部分来完成。这样就会减少明显的延迟

      - 闲时收集
        在cpu空闲的时候进行垃圾收集

    5. 内存泄漏
      对于那些永远不会使用到的对象，GC在垃圾回收的时候并不知道要不要进行释放所以对象会被保留下来，这种情况就叫做内存泄漏。

## 其他补充：

词法分析：将一行代码根据 关键字 进行分词

语法分析：根据分好的词进行解析
